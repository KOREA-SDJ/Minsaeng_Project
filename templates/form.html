<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¯¼ìƒì§€ì›ê¸ˆ ì‹ ì²­í•˜ê¸°</title>
    <style>
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; margin: 40px; background-color: #f4f7f6; }
        #container { max-width: 600px; margin: 0 auto; padding: 30px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #1e88e5; border-bottom: 2px solid #e0e0e0; padding-bottom: 15px; margin-bottom: 25px; }
        
        .section-title { font-size: 1.1em; color: #333; margin-top: 25px; margin-bottom: 10px; font-weight: bold; border-left: 4px solid #00897b; padding-left: 10px; }
        
        label { display: block; margin-top: 12px; font-weight: 600; font-size: 0.95em; color: #555; }
        input, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 15px; }
        input:focus, select:focus { border-color: #1e88e5; outline: none; }
        
        button { width: 100%; margin-top: 30px; padding: 15px; background-color: #00897b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; transition: background 0.3s; }
        button:hover { background-color: #00695c; }
        button:disabled { background-color: #ccc; cursor: not-allowed; }
        
        .hint { font-size: 0.85em; color: #888; margin-top: 3px; }
        .money-hint { color: #1e88e5; font-weight: bold; font-size: 0.9em; margin-top: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div id="container">
    <h1>ğŸ“ ì§€ì›ê¸ˆ ì‹ ì²­ì„œ ì‘ì„±</h1>
    <form id="applyForm">
        
        <div class="section-title">1. ì‹ ì²­ì ê¸°ë³¸ ì •ë³´</div>
        <label>ì„±ëª…</label>
        <input type="text" id="name" placeholder="ì˜ˆ: í™ê¸¸ë™" required>

        <label>ìƒë…„ì›”ì¼</label>
        <input type="date" id="birth_date" required>
        <div class="hint">* ë§Œ 19ì„¸ ì´ìƒë§Œ ì‹ ì²­ ê°€ëŠ¥</div>

        <label>ì£¼ì†Œ</label>
        <input type="text" id="address" placeholder="ì˜ˆ: ì„œìš¸ì‹œ ì¢…ë¡œêµ¬ ì„¸ì¢…ëŒ€ë¡œ 1" required>

        <label>ì‚¬ìš©ì ID (ì‹ ê·œ ìƒì„±)</label>
        <input type="text" id="new_id" placeholder="ì˜ˆ: U100 (ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ID ì…ë ¥)" required>

        <div class="section-title">2. ê°€êµ¬ ë° ìê²© ì •ë³´ (ì„ íƒ)</div>
        <label>ì†Œë“ í˜•íƒœ</label>
        <select id="income_type">
            <option value="ì™¸ë²Œì´">ì™¸ë²Œì´ (1ì¸ ì†Œë“)</option>
            <option value="ë‹¤ì†Œë“ì›">ë‹¤ì†Œë“ì› (ë§ë²Œì´ ë“±)</option>
        </select>

        <label>ê±´ê°•ë³´í—˜ ê°€ì…ì ìœ í˜•</label>
        <select id="sub_type">
            <option value="ì§ì¥">ì§ì¥ ê°€ì…ì</option>
            <option value="ì§€ì—­">ì§€ì—­ ê°€ì…ì</option>
            <option value="í˜¼í•©">í˜¼í•© (ì§ì¥+ì§€ì—­)</option>
        </select>

        <label>í˜„ì¬ ë³µì§€ ìê²© (ì§€ê¸‰ì•¡ ê¸°ì¤€)</label>
        <select id="qual_code">
            <option value="GENERAL">ì¼ë°˜ ì‹œë¯¼ (ê¸°ë³¸)</option>
            <option value="BASIC">ê¸°ì´ˆìƒí™œìˆ˜ê¸‰ì</option>
            <option value="SUBBASIC">ì°¨ìƒìœ„ê³„ì¸µ</option>
            <option value="TOP10">ì†Œë“ ìƒìœ„ 10%</option>
        </select>

        <label>ê°€êµ¬ì› ìˆ˜ (ëª…)</label>
        <input type="number" id="family_count" placeholder="ì˜ˆ: 3" required>

        <div class="section-title">3. ì†Œë“ ë° ì¬ì‚° ì •ë³´</div>
        <label>ì›” ê·¼ë¡œ/ì‚¬ì—… ì†Œë“ (ì›)</label>
        <input type="number" id="income" placeholder="ì˜ˆ: 2500000" required onkeyup="showKoreanMoney(this, 'income_hint')">
        <div id="income_hint" class="money-hint"></div>
        
        <label>ì—° ê¸ˆìœµ ì†Œë“ (ì´ì/ë°°ë‹¹ ë“±, ì›)</label>
        <input type="number" id="fin_income" placeholder="ì˜ˆ: 0 (ì—†ìœ¼ë©´ 0 ì…ë ¥)" required onkeyup="showKoreanMoney(this, 'fin_hint')">
        <div id="fin_hint" class="money-hint"></div>
        <div class="hint" style="margin-top:-5px; margin-bottom:10px;">* ì—°ê°„ ê¸ˆìœµì†Œë“ í•©ê³„ì•¡ ì…ë ¥</div>

        <label>ì´ ìì‚° (ë¶€ë™ì‚°, ì°¨ëŸ‰, ì „ì„¸ê¸ˆ ë“± í•©ì‚°, ì›)</label>
        <input type="number" id="assets" placeholder="ì˜ˆ: 150000000" required onkeyup="showKoreanMoney(this, 'asset_hint')">
        <div id="asset_hint" class="money-hint"></div>

        <label>ì›” ê±´ê°•ë³´í—˜ë£Œ ë‚©ë¶€ì•¡ (ì›)</label>
        <input type="number" id="hi_premium" placeholder="ì˜ˆ: 150000" required onkeyup="showKoreanMoney(this, 'hi_hint')">
        <div id="hi_hint" class="money-hint"></div>

        <button type="submit">íŒì • ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
    </form>
</div>

<script>
    /**
     * ì…ë ¥ëœ ìˆ«ì ê¸ˆì•¡ì„ í•œê¸€ ë‹¨ìœ„(ë§Œ, ì–µ, ì¡°)ë¡œ ë³€í™˜í•˜ì—¬ UIì— í‘œì‹œí•©ë‹ˆë‹¤.
     *
     * @param {HTMLInputElement} input - ê¸ˆì•¡ì´ ì…ë ¥ëœ input ìš”ì†Œ
     * @param {string} hintId - ë³€í™˜ëœ í•œê¸€ ê¸ˆì•¡ì„ ì¶œë ¥í•  div ìš”ì†Œì˜ ID
     */
    function showKoreanMoney(input, hintId) {
        const value = Number(input.value);
        const hintDiv = document.getElementById(hintId);
        
        if (!value || value === 0) {
            hintDiv.innerText = "";
            return;
        }

        const unitWords = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
        const splitUnit = 10000;
        let splitCount = unitWords.length;
        let resultArray = [];
        let resultString = '';
        let tempValue = value;

        for (let i = 0; i < splitCount; i++) {
            let unitResult = (tempValue % Math.pow(splitUnit, i + 1)) / Math.pow(splitUnit, i);
            unitResult = Math.floor(unitResult);
            if (unitResult > 0) resultArray[i] = unitResult;
        }

        for (let i = 0; i < resultArray.length; i++) {
            if (!resultArray[i]) continue;
            resultString = String(resultArray[i]) + unitWords[i] + ' ' + resultString;
        }

        hintDiv.innerText = "ğŸ‘‰ " + resultString + "ì›";
    }

    /**
     * ì‹ ì²­ì„œ í¼ ì œì¶œ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.
     * 1. ë§Œ ë‚˜ì´ ê²€ì¦ (19ì„¸ ì´ìƒ)
     * 2. í¼ ë°ì´í„° ìˆ˜ì§‘
     * 3. UI ë¡œë”© ìƒíƒœ ë³€ê²½
     * 4. ë¹„ë™ê¸° ì„œë²„ í†µì‹  ë° ê²°ê³¼ ì²˜ë¦¬
     *
     * @param {Event} e - submit ì´ë²¤íŠ¸ ê°ì²´
     */
    document.getElementById('applyForm').addEventListener('submit', function(e) {
        e.preventDefault();

        // 1. ë§Œ ë‚˜ì´ ê³„ì‚° ë° ê²€ì¦
        const birthValue = document.getElementById('birth_date').value;
        if (!birthValue) { alert("ìƒë…„ì›”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }
        
        const birthDate = new Date(birthValue);
        const today = new Date(); 
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) { 
            age--; 
        }

        if (age < 19) {
            alert("ì£„ì†¡í•©ë‹ˆë‹¤.\në§Œ 19ì„¸ ì´ìƒë§Œ ì‹ ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
            return; 
        }

        // 2. ë°ì´í„° ìˆ˜ì§‘
        const formData = {
            user_id: document.getElementById('new_id').value.trim(),
            name: document.getElementById('name').value.trim(),
            birth_date: birthValue,
            address: document.getElementById('address').value.trim(),
            income_type: document.getElementById('income_type').value,
            sub_type: document.getElementById('sub_type').value,
            qual_code: document.getElementById('qual_code').value,
            family_count: document.getElementById('family_count').value,
            income: document.getElementById('income').value,
            fin_income: document.getElementById('fin_income').value,
            hi_premium: document.getElementById('hi_premium').value,
            assets: document.getElementById('assets').value
        };

        // 3. UI ë¡œë”© ìƒíƒœ ì ìš©
        const submitBtn = document.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerText;
        submitBtn.disabled = true;
        submitBtn.innerText = "â³ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...";

        // 4. ì„œë²„ ì „ì†¡
        fetch('/api/apply', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                alert('ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                window.location.href = `/result?id=${formData.user_id}`; 
            } else {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + data.message);
                submitBtn.disabled = false;
                submitBtn.innerText = originalText;
            }
        })
        .catch(err => {
            console.error(err);
            alert('ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            submitBtn.disabled = false;
            submitBtn.innerText = originalText;
        });
    });
</script>

</body>
</html>