<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¯¼ìƒì§€ì›ê¸ˆ ìê²© íŒì • ì‹œìŠ¤í…œ</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; margin: 40px; background-color: #f4f7f6; text-align: center; }
        #container { max-width: 700px; margin: 0 auto; padding: 40px; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #1e88e5; margin-bottom: 30px; }
        
        .search-box { display: flex; gap: 10px; justify-content: center; margin-bottom: 30px; }
        input { padding: 12px; width: 60%; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
        button { padding: 12px 24px; background-color: #00897b; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; }
        button:hover { background-color: #00695c; }

        #result-area { display: none; margin-top: 30px; text-align: left; border-top: 2px solid #eee; padding-top: 20px; }
        .result-card { position: relative; background: #e3f2fd; padding: 20px; border-radius: 8px; border-left: 5px solid #2196f3; }
        .result-card.fail { background: #ffebee; border-left-color: #f44336; }
        
        .row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px dashed #ccc; padding-bottom: 5px; }
        .label { font-weight: bold; color: #555; }
        .value { font-weight: bold; color: #333; }
        .highlight { color: #d32f2f; font-size: 1.1em; }
        .success { color: #2e7d32; font-size: 1.2em; }

        .links { margin-top: 30px; }
        a { text-decoration: none; color: #1e88e5; font-weight: bold; }

        .stamp-box {
            position: absolute;
            top: 20px;
            right: 20px;
            border: 3px solid;
            padding: 5px 10px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 5px;
            transform: rotate(-15deg);
            opacity: 0.8;
            background-color: rgba(255, 255, 255, 0.7);
        }
        .stamp-pass { color: #2e7d32; border-color: #2e7d32; }
        .stamp-fail { color: #d32f2f; border-color: #d32f2f; }
    </style>
</head>
<body>

<div id="container">
    <h1>ë¯¼ìƒì§€ì›ê¸ˆ ìê²© íŒì • ì‹œìŠ¤í…œ</h1>
    
    <div class="search-box">
        <input type="text" id="userIdInput" placeholder="ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: U100)">
        <button onclick="searchResult()">ê²°ê³¼ ì¡°íšŒ</button>
    </div>

    <div id="result-area">
        <div id="result-content" class="result-card">
        </div>
    </div>

    <div class="links">
        <a href="/">ğŸ“ ìƒˆë¡œìš´ ì‹ ì²­ì„œ ì‘ì„±í•˜ê¸°</a>
    </div>
</div>

<script>
    /**
     * í˜ì´ì§€ ë¡œë“œ ì‹œ URL íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•˜ì—¬ IDê°€ ì¡´ì¬í•˜ë©´ ìë™ìœ¼ë¡œ ì¡°íšŒë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
     */
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        if (id) {
            document.getElementById('userIdInput').value = id;
            searchResult();
        }
    };

    /**
     * ì‚¬ìš©ì IDë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„œë²„ì—ì„œ íŒì • ê²°ê³¼ë¥¼ ë¹„ë™ê¸° ì¡°íšŒí•©ë‹ˆë‹¤.
     * ê²°ê³¼ ìœ ë¬´ì— ë”°ë¼ UIë¥¼ ê°±ì‹ í•˜ê±°ë‚˜ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
     */
    function searchResult() {
        const userId = document.getElementById('userIdInput').value.trim();
        if (!userId) {
            alert("ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        const resultArea = document.getElementById('result-area');
        const resultContent = document.getElementById('result-content');

        // UI ì´ˆê¸°í™” ë° ë¡œë”© í‘œì‹œ
        resultArea.style.display = 'block';
        resultContent.innerHTML = '<p style="text-align:center;">ğŸ” ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...</p>';
        resultContent.className = 'result-card'; 

        // ë°ì´í„° ìš”ì²­
        fetch(`/api/result/${userId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(response.status === 404 ? "í•´ë‹¹ IDì˜ íŒì • ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤." : "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                }
                return response.json();
            })
            .then(res => {
                if (res.status === 'success') {
                    renderResult(res.data);
                } else {
                    throw new Error(res.message);
                }
            })
            .catch(error => {
                resultContent.className = 'result-card fail';
                resultContent.innerHTML = `<p style="color:red; text-align:center;">âŒ ${error.message}</p>`;
            });
    }

    /**
     * ì¡°íšŒëœ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê²°ê³¼ ì¹´ë“œ HTMLì„ ìƒì„±í•˜ì—¬ ë Œë”ë§í•©ë‹ˆë‹¤.
     * í•©ê²©/ë¶ˆí•©ê²© ì—¬ë¶€ì— ë”°ë¼ ìŠ¤íƒ€ì¼(ë„ì¥, ìƒ‰ìƒ)ì„ ë‹¤ë¥´ê²Œ ì ìš©í•©ë‹ˆë‹¤.
     *
     * @param {Object} data - ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ í•œ íŒì • ê²°ê³¼ ë°ì´í„° ê°ì²´
     * @param {string} data.íŒì •_ê²°ê³¼ - "ì§€ê¸‰ ëŒ€ìƒ" ë˜ëŠ” "ì§€ê¸‰ ì œì™¸"
     * @param {number} data.ì§€ê¸‰_ì˜ˆì •ì•¡ - ì§€ê¸‰ ê²°ì •ëœ ê¸ˆì•¡
     * @param {string} data.íƒˆë½_ì‚¬ìœ _ìƒì„¸ - íƒˆë½ ì‹œ í‘œì‹œë  ìƒì„¸ ì‚¬ìœ 
     */
    function renderResult(data) {
        const content = document.getElementById('result-content');
        const isEligible = data.íŒì •_ê²°ê³¼ === 'ì§€ê¸‰ ëŒ€ìƒ';
        
        // ì¹´ë“œ ìŠ¤íƒ€ì¼ ë° ë„ì¥ ìƒì„±
        content.className = isEligible ? 'result-card' : 'result-card fail';
        const stampHtml = isEligible 
            ? '<div class="stamp-box stamp-pass">âœ… ì§€ê¸‰ ëŒ€ìƒ</div>' 
            : '<div class="stamp-box stamp-fail">ğŸš« ì§€ê¸‰ ì œì™¸</div>';

        const payment = new Intl.NumberFormat('ko-KR').format(data.ì§€ê¸‰_ì˜ˆì •ì•¡);

        // íƒˆë½ ì‚¬ìœ  ì²˜ë¦¬ (ëŒ€ìƒìê°€ ì•„ë‹ ê²½ìš°ì—ë§Œ í‘œì‹œ)
        let reasonHtml = '';
        if (!isEligible) {
            reasonHtml = `
            <div class="row" style="border-bottom:none;">
                <span class="label">ìƒì„¸ ì‚¬ìœ </span>
                <span class="value">${data.íƒˆë½_ì‚¬ìœ _ìƒì„¸}</span>
            </div>`;
        }

        // ìµœì¢… HTML ì¡°ë¦½
        const html = `
            ${stampHtml} 
            <h2 style="text-align:center; margin-top:0;">
                ${data.ì‹ ì²­ì_ì´ë¦„}ë‹˜ì˜ íŒì • ê²°ê³¼
            </h2>
            <div class="row">
                <span class="label">íŒì • ë²ˆí˜¸</span>
                <span class="value">${data.íŒì •_ë²ˆí˜¸}</span>
            </div>
            <div class="row">
                <span class="label">ìµœì¢… ê²°ê³¼</span>
                <span class="value ${isEligible ? 'success' : 'highlight'}">${data.íŒì •_ê²°ê³¼}</span>
            </div>
            <div class="row" ${isEligible ? 'style="border-bottom:none;"' : ''}>
                <span class="label">ì§€ê¸‰ ì˜ˆì •ì•¡</span>
                <span class="value">${payment}ì›</span>
            </div>
            ${reasonHtml}
        `;
        content.innerHTML = html;
    }
</script>

</body>
</html>